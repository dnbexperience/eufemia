"use strict";(self.webpackChunkdnb_design_system_portal=self.webpackChunkdnb_design_system_portal||[]).push([[6833],{11850:function(e,n,t){var r=t(84616),o=t(2784),c=t(72779),u=t.n(c),s=t(95955),i=t.n(s),l=t(26409),a=t(37339),d=t(61890),f=t(82507),h=t(26),m=t(30392),v=t(38875),p=t(51022),b=t(58106),x=t(88069),Z=t(57039),C=t(8160),g=t(52322);function j(e){var n;const{0:t,1:c}=(0,o.useReducer)((()=>({})),{}),s=(0,o.useContext)(p.Z),j=(0,o.useContext)(b.Z),{getValue:w}=(0,C.Z)(),R=(0,o.useMemo)((()=>{const{path:n,countPath:t,countPathLimit:r=1/0,countPathTransform:o}=e;if(t){const c=w(n);let u=parseFloat(w(t));if(u>=0||(u=0),u>r&&(u=r),(null==c?void 0:c.length)!==u){const n=[];for(let e=0,t=u;e<t;e++){const t=null==c?void 0:c[e];n.push(null==o?void 0:o({value:t,index:e}))}return{...e,value:n}}}return e}),[w,e]),{path:_,value:k,withoutFlex:y,emptyValue:N,placeholder:P,handleChange:E,onChange:S,children:M}=(0,l.Z)(R),A=(0,o.useRef)([]),V=(0,o.useRef)({}),B=(0,o.useRef)({}),F=(0,o.useRef)(),I=(0,o.useRef)(k),O=(0,o.useRef)(),L=(0,o.useRef)(),T=(0,o.useRef)({}),$=null!=y?y:s||j;(0,o.useEffect)((()=>{I.current=k||[]}),[k]);const q=(0,o.useMemo)((()=>{var e;return(null!==(e=F.current||k)&&void 0!==e?e:[]).map(((e,n)=>{var t;const o=A.current[n]||(0,a.Xo)(),u=k.length>(null===(t=I.current)||void 0===t?void 0:t.length);A.current[n]||(V.current[o]=u,A.current.push(o));const s=V.current[o]||!1;return B.current[o]||(B.current[o]=s?"edit":"view"),{id:o,path:_,value:e,index:n,arrayValue:k,containerRef:O,isNew:s,containerMode:B.current[o],switchContainerMode:e=>{var n;B.current[o]=e,null===(n=V.current)||void 0===n||delete n[o],c()},handleChange:(e,t)=>{const r=(0,Z.ZP)(k);r[n]={...r[n]},i().set(r,e,t),E(r)},handlePush:e=>{L.current=!0,E([].concat((0,r.Z)(null!=k?k:[]),[e]))},handleRemove:function(e){let{keepItems:t=!1}=void 0===e?{}:e;t&&(F.current=k);const r=(0,Z.ZP)(k);r.splice(n,1),E(r)},fulfillRemove:()=>{var e,n;F.current=null,null===(e=B.current)||void 0===e||delete e[o],null===(n=V.current)||void 0===n||delete n[o];const t=A.current.indexOf(o);A.current.splice(t,1),c()},restoreOriginalValue:e=>{const t=(0,Z.ZP)(k);t[n]=e,E(t)}}}))}),[t,k,_,E]);(0,o.useMemo)((()=>{const e=null==q?void 0:q[q.length-1];null!=e&&e.isNew&&!L.current?null==S||S(k):L.current=!1}),[k,q,S]);const z={className:u()("dnb-forms-iterate","dnb-forms-section",null==e?void 0:e.className),...(0,m.W)(e),...(0,h.SR)(e),innerRef:O},D=$?o.Fragment:d.Z;return(0,g.jsx)(D,{...$?null:z,children:k===N||0===(null==e||null===(n=e.value)||void 0===n?void 0:n.length)?P:q.map((e=>{const{id:n,value:t,index:r}=e,c=T.current[n]=T.current[n]||(0,o.createRef)(),u=e=>"function"==typeof e?e(t,r):e,s={...e,elementRef:c},i=Array.isArray(M)?M.map((e=>u(e))):u(M);return $?(0,g.jsx)(v.Z.Provider,{value:s,children:(0,g.jsx)(x.Z,{children:i})},`element-${n}`):(0,g.jsx)(f.Z,{className:"dnb-forms-iterate__element",tabIndex:-1,innerRef:c,children:(0,g.jsx)(v.Z.Provider,{value:s,children:(0,g.jsx)(x.Z,{children:i})})},`element-${n}`)}))})}j._supportsSpacingProps=!0,n.Z=j},49414:function(e,n,t){t.r(n),t.d(n,{AnimatedContainer:function(){return z},Array:function(){return C.Z},ArrayPushButton:function(){return U},ArrayRemoveElementButton:function(){return Y},Count:function(){return G},EditContainer:function(){return F},IterateElementContext:function(){return i.Z},PushButton:function(){return m},RemoveButton:function(){return Z},Toolbar:function(){return B},ViewContainer:function(){return $},count:function(){return K},useCount:function(){return Q}});var r=t(84616),o=t(2784),c=t(72779),u=t.n(c),s=t(96844),i=t(38875),l=t(26409),a=t(27439),d=t(93206),f=t(52322);function h(e){const n=(0,o.useContext)(i.Z),{handlePush:t}=null!=n?n:{},{pushValue:c,className:h,...m}=e,v=(0,a.wH)(m),{value:p,handleChange:b,children:x}=(0,l.Z)(m);if(void 0!==p&&!Array.isArray(p))throw new Error("PushButton received a non-array value");const Z=(0,o.useCallback)((()=>{const e="function"==typeof c?c(p):c;t?t(e):b([].concat((0,r.Z)(null!=p?p:[]),[e]))}),[p,c,t,b]);return(0,f.jsx)(s.Z,{className:u()("dnb-forms-iterate-push-button",h),variant:"secondary",icon:d.Z,icon_position:"left",on_click:Z,...v,children:x})}h._supportsSpacingProps=!0;var m=h,v=t(67863);var p=(0,o.createContext)(null),b=t(42277);function x(e){const n=(0,o.useContext)(i.Z),{handleRemove:t}=null!=n?n:{};if(!n)throw new Error("RemoveButton must be inside an Iterate.Array");const{className:r,...c}=e,{children:d,text:h}=(0,l.Z)(c),m=(0,a.wH)(c),x=(0,v.Z)().Section,Z=h||d||x.remove,C=(0,o.useContext)(p),{handleRemoveBlock:g}=null!=C?C:{},j=(0,o.useCallback)((()=>{g?g():t()}),[t,g]);return(0,f.jsx)(s.Z,{className:u()("dnb-forms-iterate-remove-element-button",r),variant:Z?"tertiary":"secondary",icon:b.Z,icon_position:"left",on_click:j,...m,children:Z})}x._supportsSpacingProps=!0;var Z=x,C=t(11850),g=t(37339),j=t(58984),w=t(79583),R=t(89751),_=t(72691),k=t(88952),y=t(81011);function N(){const{restoreOriginalValue:e,switchContainerMode:n,containerMode:t,arrayValue:r,index:c,isNew:u}=(0,o.useContext)(i.Z)||{},{hasVisibleError:l}=(0,o.useContext)(y.Z)||{},a=(0,v.Z)().Section,d=(0,o.useRef)(),h=function(e){let{isNew:n,containerMode:t}=e;const r=(0,o.useRef)(n);return(0,o.useEffect)((()=>{"view"===t&&(r.current=!1)}),[n,t]),r.current}({isNew:u,containerMode:t}),{0:m,1:p}=(0,o.useState)(!1);(0,o.useEffect)((()=>{"edit"!==t||d.current||(d.current=null==r?void 0:r[c]),"view"===t&&(d.current=null)}),[r,t,c]);const b=(0,o.useCallback)((()=>{d.current&&(null==e||e(d.current)),p(!1),null==n||n("view")}),[e,n]),x=(0,o.useCallback)((()=>{l?p(!0):(p(!1),null==n||n("view"))}),[l,n]);return(0,f.jsxs)(f.Fragment,{children:[(0,f.jsx)(w.ZP,{show:m&&l,no_animation:!1,children:a.errorInSection}),(0,f.jsxs)(R.Z,{gap:"large",children:[(0,f.jsx)(s.Z,{variant:"tertiary",icon:_.Z,icon_position:"left",on_click:x,children:a.done}),h?(0,f.jsx)(Z,{}):(0,f.jsx)(s.Z,{variant:"tertiary",icon:k.Z,icon_position:"left",on_click:b,children:a.cancel})]})]})}var P=t(91974),E=t(61890);function S(e){const{1:n}=(0,o.useReducer)((()=>({})),{}),t=(0,o.useRef)();t.current=(0,o.useContext)(i.Z)||{};const{hasError:r,hasSubmitError:c}=(0,o.useContext)(y.Z)||{};t.current.hasError=r,t.current.hasSubmitError=c,c&&(t.current.containerMode="edit");const{handleRemove:s,switchContainerMode:l,containerMode:a,isNew:d}=t.current,{mode:h,open:m,ariaLabel:v,onAnimationEnd:b,className:x,children:Z,openDelay:C=100,variant:g="outline",...j}=e,w=(0,o.useRef)(null!=m?m:a===h&&!d),R=(0,o.useRef)(!1),_=(0,o.useCallback)((e=>{w.current=e,n()}),[]);(0,o.useEffect)((()=>{R.current||(void 0!==m?_(m):w.current!==(a===h)&&(d?setTimeout((()=>{_(a===h)}),C):_(a===h)))}),[a,d,h,m,C,_]);const k=(0,o.useCallback)((e=>{t.current.hasSubmitError&&(null==l||l("edit"));var n,r,o,c,u,s;t.current.hasSubmitError||("opened"===e?null===(n=t.current)||void 0===n||null===(r=n.elementRef)||void 0===r||null===(o=r.current)||void 0===o||null===(c=o.focus)||void 0===c||c.call(o):window.requestAnimationFrame((()=>{try{var e;if(null===(e=document.activeElement)||void 0===e||!e.closest(".dnb-forms-iterate__element")){var n;const e=null===(n=t.current)||void 0===n?void 0:n.containerRef.current.querySelectorAll(".dnb-forms-iterate__element");e[e.length-1].focus()}}catch(r){}})));!w.current&&R.current&&(R.current=!1,null===(u=t.current)||void 0===u||null===(s=u.fulfillRemove)||void 0===s||s.call(u));null==b||b(e)}),[b,l]),N=(0,o.useCallback)((()=>{R.current=!0,null==s||s({keepItems:!0}),_(!1)}),[s,_]);return(0,f.jsx)(p.Provider,{value:{handleRemoveBlock:N},children:(0,f.jsx)(P.Z,{className:u()("dnb-forms-section-block",g&&`dnb-forms-section-block--variant-${g}`,d&&"dnb-forms-section-block--new",t.current.hasSubmitError&&"dnb-forms-section-block--error",x),open:w.current,onAnimationEnd:k,duration:450,keepInDOM:!0,children:(0,f.jsx)(E.Z,{className:"dnb-forms-section-block__inner",...j,element:"section","aria-label":v,children:Z})})})}S._supportsSpacingProps=!0;var M=S,A=t(85192),V=t(80215);function B(e){const{children:n,className:t,...r}=e||{};return(0,f.jsxs)(V.Z,{top:"medium",className:u()("dnb-forms-iterate-toolbar",t),...r,children:[(0,f.jsx)(A.Z,{space:0}),(0,f.jsx)(R.Z,{top:"x-small",gap:"large",children:n})]})}function F(e){return(0,f.jsx)(I,{toolbar:(0,f.jsx)(B,{children:(0,f.jsx)(N,{})}),...e})}function I(e){const n=(0,o.useContext)(i.Z),{containerMode:t,isNew:r}=null!=n?n:{},{children:c,className:s,title:l,titleWhenNew:a,toolbar:d,...h}=e||{},m=(0,o.useRef)(r);(0,o.useEffect)((()=>{"view"===t&&(m.current=!1)}),[r,t]);const v=m.current&&a?a:l,p=(0,o.useMemo)((()=>(0,g.F4)(v)),[v]);return(0,f.jsxs)(M,{mode:"edit",className:u()("dnb-forms-section-edit-block",s),ariaLabel:p,...h,children:[v&&(0,f.jsx)(j.Z,{size:"basis",children:v}),c,d]})}B._supportsSpacingProps=!0,F._supportsSpacingProps=!0,I._supportsSpacingProps=!0;var O=t(28352);function L(){const e=(0,o.useContext)(i.Z),{switchContainerMode:n}=null!=e?e:{},t=(0,v.Z)().Section,r=(0,o.useCallback)((()=>{null==n||n("edit")}),[n]);return(0,f.jsxs)(R.Z,{gap:"large",children:[(0,f.jsx)(s.Z,{variant:"tertiary",icon:O.Z,icon_position:"left",on_click:r,children:t.edit}),(0,f.jsx)(Z,{text:t.remove})]})}function T(e){const{children:n,className:t,title:r,...c}=e||{},s=(0,o.useMemo)((()=>(0,g.F4)(r)),[r]);return(0,f.jsx)(M,{mode:"view",ariaLabel:s,className:u()("dnb-forms-section-view-block",t),...c,children:(0,f.jsxs)(E.Z,{children:[r&&(0,f.jsx)(j.Z,{size:"basis",children:r}),n,(0,f.jsx)(B,{children:(0,f.jsx)(L,{})})]})})}T._supportsSpacingProps=!0;var $=T;function q(e){const n=(0,o.useContext)(i.Z),{isNew:t}=null!=n?n:{};return(0,f.jsx)(I,{open:!t||void 0,...e})}q._supportsSpacingProps=!0;var z=q,D=t(95955),H=t.n(D),W=t(49118),X=t(91749);function G(e){const{data:n}=(0,W.Z)(e.id);return J(n,e)}function J(e,n){let{path:t,filter:r}=n;if(H().has(e,t)){const n=H().get(e,t);if(Array.isArray(n))return r?n.filter(r).length:n.length;if("object"==typeof n&&n)return r?Object.entries(n).filter(r).length:Object.keys(n).length}return NaN}function K(e){const{data:n}=(0,X.Z)(e.id);return J(n,e)}function Q(e){void 0===e&&(e=void 0);const{data:n}=(0,W.Z)(e);return{count:(0,o.useCallback)(((e,t)=>J(n,{path:e,filter:t})),[n])}}const U=m,Y=Z}}]);
//# sourceMappingURL=a910553810bb12cfe833c5140199978ee8f9516f-7401c6255a34b5370193.js.map