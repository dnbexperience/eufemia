"use strict";(self.webpackChunkdnb_design_system_portal=self.webpackChunkdnb_design_system_portal||[]).push([[24342],{74416:function(e,s,n){n.r(s);var i=n(31085),a=n(71184);function r(e){const s=Object.assign({h1:"h1",h2:"h2",p:"p",code:"code",h3:"h3",pre:"pre",h4:"h4",ul:"ul",li:"li",a:"a"},(0,a.R)(),e.components);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.h1,{children:"Frequently Asked Questions (FAQ)"}),"\n",(0,i.jsx)(s.h2,{children:"Visual tests and Playwright"}),"\n",(0,i.jsxs)(s.p,{children:["Jest starts several workers at the same time. When we simulate states on e.g., ToggleButton and Button, Playwright (v1.31.2) struggles to handle this. Some of the hover or focus tests will fail. To ensure Jest never executes several workers at the same time, we set ",(0,i.jsx)(s.code,{children:"--maxWorkers=1"}),"."]}),"\n",(0,i.jsx)(s.h3,{children:"Installing screenshot browser"}),"\n",(0,i.jsx)(s.p,{children:"For running screenshot tests (visual tests), a headless Firefox browser is needed."}),"\n",(0,i.jsxs)(s.p,{children:["In normal circumstances, the browser will be installed automatically via ",(0,i.jsx)(s.code,{children:"yarn install"})," â€“ but to either upgrade to a newer version, or to wipe out existing versions and run the install manually, you can run these commands, depending on your needs:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"yarn workspace @dnb/eufemia playwright uninstall --all\nyarn workspace @dnb/eufemia add -D @playwright/test\nyarn workspace @dnb/eufemia playwright install firefox\n\nyarn workspace dnb-design-system-portal playwright uninstall --all\nyarn workspace dnb-design-system-portal add -D @playwright/test\nyarn workspace dnb-design-system-portal playwright install firefox\n"})}),"\n",(0,i.jsx)(s.h4,{children:"Alternative install: skip authentication"}),"\n",(0,i.jsxs)(s.p,{children:["However, since Node.js and corporate proxies do not enjoy each other's company, this might\nfail with an ",(0,i.jsx)(s.code,{children:"Error: unable to get local issuer certificate"})," error. In that case, your only\noption might be to disable all authentication for this command."]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{children:"NODE_TLS_REJECT_UNAUTHORIZED=0 yarn workspace @dnb/eufemia playwright install firefox\n"})}),"\n",(0,i.jsx)(s.h4,{children:"Alternative install: manually"}),"\n",(0,i.jsxs)(s.p,{children:["Or, in the very worst case, you can manually download the zip file that ",(0,i.jsx)(s.code,{children:"yarn workspace  @dnb/eufemia playwright install firefox"}),' attempts to download, and extract the file\n("Nightly" for Firefox) to the folder indicated when ',(0,i.jsx)(s.code,{children:"yarn test:screenshots"})," fails."]}),"\n",(0,i.jsx)(s.h2,{children:"How can I run all screenshot tests without stopping on first failure?"}),"\n",(0,i.jsxs)(s.p,{children:["By default, screenshot tests stop on the first failure (",(0,i.jsx)(s.code,{children:"--bail"})," flag). To run all tests and see all failures at once, include ",(0,i.jsx)(s.code,{children:"--run-all"})," in your commit message:"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:'git commit -m "feat: implement new feature --run-all"\n'})}),"\n",(0,i.jsxs)(s.p,{children:["This will disable the ",(0,i.jsx)(s.code,{children:"--bail"})," flag and run all screenshot tests, showing you all visual differences at once. This is particularly useful when you're making changes that might affect multiple components and want to see the full scope of visual changes."]}),"\n",(0,i.jsx)(s.p,{children:"The CI/CD pipeline automatically detects this flag and adjusts the test behavior accordingly."}),"\n",(0,i.jsx)(s.h2,{children:"How can I make faster builds?"}),"\n",(0,i.jsx)(s.p,{children:'This is only meant for "setup-testing" purposes! To make faster local builds, you can:'}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Inside ",(0,i.jsx)(s.code,{children:"gatsby-config.js"}),", rename all sourcing from ",(0,i.jsx)(s.code,{children:"/docs"})," to ",(0,i.jsx)(s.code,{children:"/docs_dummy"}),"."]}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:["Run ",(0,i.jsx)(s.code,{children:"yarn workspace dnb-design-system-portal build:visual-test"}),"."]}),"\n",(0,i.jsxs)(s.p,{children:["You can also run ",(0,i.jsx)(s.code,{children:"filter=button,input yarn start"})," (case sensitive) to only run specific pages."]}),"\n",(0,i.jsxs)(s.h3,{children:["What are ",(0,i.jsx)(s.code,{children:"build:mini"})," scripts"]}),"\n",(0,i.jsxs)(s.p,{children:["When running ",(0,i.jsx)(s.code,{children:"build:mini"})," scripts, the build will be faster and the output will be smaller. Its used for the CI/CD pipeline to build the package for the Sandbox or documentation preview."]}),"\n",(0,i.jsxs)(s.p,{children:["For the Portal, ",(0,i.jsx)(s.code,{children:"build:mini"})," (",(0,i.jsx)(s.code,{children:"BUILD_MINI=1"}),") also skips some Gatsby plugins and processing steps to speed up the build. This currently includes:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"gatsby-plugin-eufemia-llm-metadata"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"gatsby-plugin-manifest"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"gatsby-plugin-meta-redirect"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"gatsby-plugin-offline"})}),"\n",(0,i.jsx)(s.li,{children:(0,i.jsx)(s.code,{children:"gatsby-plugin-algolia"})}),"\n",(0,i.jsxs)(s.li,{children:["Image processing (",(0,i.jsx)(s.code,{children:"gatsby-plugin-sharp"}),", ",(0,i.jsx)(s.code,{children:"gatsby-remark-images"}),")"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{children:"Dependency issues"}),"\n",(0,i.jsx)(s.h3,{children:"ESLint compat patch"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["We patch ",(0,i.jsx)(s.code,{children:"eslint-plugin-compat"})," to always report APIs, even inside ",(0,i.jsx)(s.code,{children:"if"})," statements. The patch lives in ",(0,i.jsx)(s.code,{children:".yarn/patches/"})," and is referenced from ",(0,i.jsx)(s.code,{children:"packages/dnb-eufemia/package.json"})," as ",(0,i.jsx)(s.code,{children:"patch:eslint-plugin-compat@npm:*"}),". If you reinstall dependencies, keep the patch or reapply it with ",(0,i.jsx)(s.code,{children:"yarn patch-commit"}),"."]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{children:"Jest"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["jsdom ",(0,i.jsx)(s.a,{href:"https://github.com/jsdom/jsdom/releases/tag/21.0.0",children:"v21"})," changed ",(0,i.jsx)(s.code,{children:"window"}),", ",(0,i.jsx)(s.code,{children:"document"}),", ",(0,i.jsx)(s.code,{children:"location"}),", and top properties of Window to be non-configurable, which made it impossible to mock ",(0,i.jsx)(s.code,{children:"window.location"})," in Jest. While there are workarounds, we decided to use v20 instead of the latest (",(0,i.jsx)(s.code,{children:'"jest-environment-jsdom/jsdom": "20.0.3"'}),")."]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{children:"Babel"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Due to this bug: ",(0,i.jsx)(s.a,{href:"https://github.com/babel/babel/issues/11394",children:"https://github.com/babel/babel/issues/11394"})," we add ",(0,i.jsx)(s.code,{children:".png,.snap"})," so they do not get copied: ",(0,i.jsx)(s.code,{children:"--extensions '.js,.ts,.tsx,.png,.snap'"})]}),"\n"]}),"\n",(0,i.jsx)(s.h3,{children:"Yarn PnP"}),"\n",(0,i.jsxs)(s.p,{children:["Eufemia uses yarn with ",(0,i.jsx)(s.code,{children:"node_modules"}),"."]}),"\n",(0,i.jsx)(s.p,{children:"When switching over to Yarn PnP, there are some issues:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Storybook:","\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"ERROR in eufemia/.yarn/__virtual__/@dnb-eufemia-virtual-761b82657c/1/packages/dnb-eufemia/src/components/slider/style/dnb-range.scss (eufemia/.yarn/__virtual__/css-loader-virtual-37c5c374e4/0/cache/css-loader-npm-5.2.7-e1e8b8d16f-fb0742b30a.zip/node_modules/css-loader/dist/cjs.js!eufemia/.yarn/__virtual__/sass-loader-virtual-577853f541/0/cache/sass-loader-npm-10.2.0-91ed64638b-d53212e5d1.zip/node_modules/sass-loader/dist/cjs.js!eufemia/.yarn/__virtual__/@dnb-eufemia-virtual-761b82657c/1/packages/dnb-eufemia/src/components/slider/style/dnb-range.scss)\nModule build failed (from eufemia/.yarn/__virtual__/sass-loader-virtual-577853f541/0/cache/sass-loader-npm-10.2.0-91ed64638b-d53212e5d1.zip/node_modules/sass-loader/dist/cjs.js):\nSassError: File to import not found or unreadable: eufemia/.yarn/__virtual__/@dnb-eufemia-virtual-761b82657c/1/packages/dnb-eufemia/src/style/components/imports.scss.\n        on line 6 of ../../.yarn/__virtual__/@dnb-eufemia-virtual-761b82657c/1/packages/dnb-eufemia/src/components/slider/style/dnb-range.scss\n>> @import '../../../style/components/imports.scss';\n"})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["Gatsby","\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-bash",children:"gatsby-plugin-mdx tried to access mkdirp, but it isn't declared in its dependencies; this makes the require call ambiguous and unsound.\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(s.h2,{children:"MDX v1 > v2/v3"}),"\n",(0,i.jsxs)(s.p,{children:["In MDX v1 the Portal used an MDX template (",(0,i.jsx)(s.code,{children:"./templates/mdx.js"}),") with the ",(0,i.jsx)(s.code,{children:"createPage"}),' API. This is currently not the case anymore.\nInstead, the "PortalLayout" is used to wrap ',(0,i.jsx)(s.code,{children:".mdx"})," pages inside the ",(0,i.jsx)(s.code,{children:"wrapPageElement"})," API.\nThis is due to the ",(0,i.jsx)(s.code,{children:"JavaScript heap out of memory"})," error when using templates."]}),"\n",(0,i.jsx)(s.h2,{children:"I get a Gatsby 404 Not Found error on the pages I work on"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["Try cleaning the cache: ",(0,i.jsx)(s.code,{children:"yarn workspace dnb-design-system-portal gatsby clean"})]}),"\n",(0,i.jsxs)(s.li,{children:["Try running ",(0,i.jsx)(s.code,{children:"yarn build"})," again"]}),"\n"]})]})}s.default=function(e){void 0===e&&(e={});const{wrapper:s}=Object.assign({},(0,a.R)(),e.components);return s?(0,i.jsx)(s,Object.assign({},e,{children:(0,i.jsx)(r,e)})):r(e)}}}]);
//# sourceMappingURL=component---src-docs-contribute-faq-mdx-f858623a4c076fba3390.js.map