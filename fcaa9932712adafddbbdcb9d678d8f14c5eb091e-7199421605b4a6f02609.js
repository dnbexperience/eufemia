"use strict";(self.webpackChunkdnb_design_system_portal=self.webpackChunkdnb_design_system_portal||[]).push([[46573],{6350:function(e,n,r){r.r(n),r.d(n,{AnimatedContainer:function(){return Y},Array:function(){return M},ArrayPushButton:function(){return ue},ArrayRemoveElementButton:function(){return ce},Count:function(){return re},EditContainer:function(){return W},IterateElementContext:function(){return l.Z},PushButton:function(){return v},RemoveButton:function(){return Z},Toolbar:function(){return T},ViewContainer:function(){return Q},count:function(){return oe},useCount:function(){return se}});var t=r(84616),o=r(2784),s=r(72779),u=r.n(s),c=r(96844),l=r(38875),i=r(26409),a=r(27439),d=r(93206),f=r(52322);function h(e){const n=(0,o.useContext)(l.Z),{handlePush:r}=null!=n?n:{},{pushValue:s,className:h,...v}=e,m=(0,a.wH)(v),{value:p,handleChange:x,children:b}=(0,i.Z)(v);if(void 0!==p&&!Array.isArray(p))throw new Error("PushButton received a non-array value");const Z=(0,o.useCallback)((()=>{const e="function"==typeof s?s(p):s;r?r(e):x([].concat((0,t.Z)(null!=p?p:[]),[e]))}),[p,s,r,x]);return(0,f.jsx)(c.Z,{className:u()("dnb-forms-iterate-push-button",h),variant:"secondary",icon:d.Z,icon_position:"left",on_click:Z,...m,children:b})}h._supportsSpacingProps=!0;var v=h,m=r(21608);var p=(0,o.createContext)(null),x=r(42277);function b(e){const n=(0,o.useContext)(l.Z),{handleRemove:r}=null!=n?n:{};if(!n)throw new Error("RemoveButton must be inside an Iterate.Array");const{className:t,...s}=e,{children:d,text:h}=(0,i.Z)(s),v=(0,a.wH)(s),b=(0,m.Z)().Iterate,Z=h||d||b.remove,w=(0,o.useContext)(p),{handleRemoveBlock:C}=null!=w?w:{},j=(0,o.useCallback)((()=>{C?C():r()}),[r,C]);return(0,f.jsx)(c.Z,{className:u()("dnb-forms-iterate-remove-element-button",t),variant:Z?"tertiary":"secondary",icon:x.Z,icon_position:"left",on_click:j,...v,children:Z})}b._supportsSpacingProps=!0;var Z=b,w=r(95955),C=r.n(w),j=r(37339),R=r(61890),g=r(82507),k=r(26),_=r(30392),y=r(51022),N=r(58106),E=r(81011),A=r(21068);function P(e){let{children:n}=e;const{showAllErrors:r}=(0,o.useContext)(A.Z),t=(0,o.useRef)({}),s=Object.keys(t.current||{}).length>0,u=r&&s,c=(0,o.useCallback)(((e,n)=>{var r;n?t.current[e]=!!n:null===(r=t.current)||void 0===r||delete r[e]}),[]),l={hasError:s,hasErrorAndShowIt:u,errorsRef:t,setFieldError:c};return(0,f.jsx)(E.Z.Provider,{value:l,children:n})}var S=r(57039);function I(e){var n;const{0:r,1:s}=(0,o.useReducer)((()=>({})),{}),c=(0,o.useContext)(y.Z),a=(0,o.useContext)(N.Z),{path:d,value:h,withoutFlex:v,emptyValue:m,placeholder:p,handleChange:x,onChange:b,children:Z}=(0,i.Z)(e),w=(0,o.useRef)([]),E=(0,o.useRef)({}),A=(0,o.useRef)({}),I=(0,o.useRef)(),M=(0,o.useRef)(h),B=(0,o.useRef)(),O=(0,o.useRef)(),V=(0,o.useRef)({}),F=null!=v?v:c||a;(0,o.useEffect)((()=>{M.current=h||[]}),[h]);const L=(0,o.useMemo)((()=>{var e;return(null!==(e=I.current||h)&&void 0!==e?e:[]).map(((e,n)=>{var r;const o=w.current[n]||(0,j.Xo)(),u=h.length>(null===(r=M.current)||void 0===r?void 0:r.length);w.current[n]||(E.current[o]=u,w.current.push(o));const c=E.current[o]||!1;return A.current[o]||(A.current[o]=c?"edit":"view"),{id:o,path:d,value:e,index:n,arrayValue:h,containerRef:B,isNew:c,containerMode:A.current[o],switchContainerMode:e=>{var n;A.current[o]=e,null===(n=E.current)||void 0===n||delete n[o],s()},handleChange:(e,r)=>{const t=(0,S.ZP)(h);t[n]={...t[n]},C().set(t,e,r),x(t)},handlePush:e=>{O.current=!0,x([].concat((0,t.Z)(null!=h?h:[]),[e]))},handleRemove:function(e){let{keepItems:r=!1}=void 0===e?{}:e;r&&(I.current=h);const t=(0,S.ZP)(h);t.splice(n,1),x(t)},fulfillRemove:()=>{var e,n;I.current=null,null===(e=A.current)||void 0===e||delete e[o],null===(n=E.current)||void 0===n||delete n[o];const r=w.current.indexOf(o);w.current.splice(r,1),s()},restoreOriginalValue:e=>{const r=(0,S.ZP)(h);r[n]=e,x(r)}}}))}),[r,h,d,x]);(0,o.useMemo)((()=>{const e=null==L?void 0:L[L.length-1];null!=e&&e.isNew&&!O.current?null==b||b(h):O.current=!1}),[h,L,b]);const $={className:u()("dnb-forms-iterate",null==e?void 0:e.className),...(0,_.W)(e),...(0,k.SR)(e),innerRef:B},q=F?o.Fragment:R.Z;return(0,f.jsx)(q,{...F?null:$,children:h===m||0===(null==e||null===(n=e.value)||void 0===n?void 0:n.length)?p:L.map((e=>{const{id:n,value:r,index:t}=e,s=V.current[n]=V.current[n]||(0,o.createRef)(),u=e=>"function"==typeof e?e(r,t):e,c={...e,elementRef:s},i=Array.isArray(Z)?Z.map((e=>u(e))):u(Z);return F?(0,f.jsx)(l.Z.Provider,{value:c,children:(0,f.jsx)(P,{children:i})},`element-${n}`):(0,f.jsx)(g.Z,{className:"dnb-forms-iterate__element",tabIndex:-1,innerRef:s,children:(0,f.jsx)(l.Z.Provider,{value:c,children:(0,f.jsx)(P,{children:i})})},`element-${n}`)}))})}I._supportsSpacingProps=!0;var M=I,B=r(58984),O=r(89751),V=r(72691),F=r(88952);function L(){const{restoreOriginalValue:e,switchContainerMode:n,containerMode:r,arrayValue:t,index:s,isNew:u}=(0,o.useContext)(l.Z)||{},{hasErrorAndShowIt:i}=(0,o.useContext)(E.Z)||{},a=(0,m.Z)().Iterate,d=(0,o.useRef)(),h=function(e){let{isNew:n,containerMode:r}=e;const t=(0,o.useRef)(n);return(0,o.useEffect)((()=>{"view"===r&&(t.current=!1)}),[n,r]),t.current}({isNew:u,containerMode:r});(0,o.useEffect)((()=>{"edit"!==r||d.current||(d.current=null==t?void 0:t[s]),"view"===r&&(d.current=null)}),[t,r,s]);const v=(0,o.useCallback)((()=>{d.current&&(null==e||e(d.current)),null==n||n("view")}),[e,n]),p=(0,o.useCallback)((()=>{null==n||n("view")}),[n]);return(0,f.jsxs)(O.Z,{gap:"large",children:[(0,f.jsx)(c.Z,{variant:"tertiary",icon:V.Z,icon_position:"left",on_click:p,disabled:i,children:a.done}),h?(0,f.jsx)(Z,{}):(0,f.jsx)(c.Z,{variant:"tertiary",icon:F.Z,icon_position:"left",on_click:v,children:a.cancel})]})}var $=r(91974);function q(e){const{1:n}=(0,o.useReducer)((()=>({})),{}),r=(0,o.useRef)();r.current=(0,o.useContext)(l.Z)||{};const{hasError:t,hasErrorAndShowIt:s}=(0,o.useContext)(E.Z)||{};r.current.hasError=t,r.current.hasErrorAndShowIt=s,s&&(r.current.containerMode="edit");const{handleRemove:c,switchContainerMode:i,containerMode:a,isNew:d}=r.current,{mode:h,open:v,ariaLabel:m,onAnimationEnd:x,className:b,children:Z,openDelay:w=100,variant:C="outline",...j}=e,g=(0,o.useRef)(null!=v?v:a===h&&!d),k=(0,o.useRef)(!1),_=(0,o.useCallback)((e=>{g.current=e,n()}),[]);(0,o.useEffect)((()=>{k.current||(void 0!==v?_(v):g.current!==(a===h)&&(d?setTimeout((()=>{_(a===h)}),w):_(a===h)))}),[a,d,h,v,w,_]);const y=(0,o.useCallback)((e=>{r.current.hasErrorAndShowIt&&i("edit");var n,t,o,s,u,c;r.current.hasErrorAndShowIt||("opened"===e?null===(n=r.current)||void 0===n||null===(t=n.elementRef)||void 0===t||null===(o=t.current)||void 0===o||null===(s=o.focus)||void 0===s||s.call(o):window.requestAnimationFrame((()=>{try{var e;if(null===(e=document.activeElement)||void 0===e||!e.closest(".dnb-forms-iterate__element")){var n;const e=null===(n=r.current)||void 0===n?void 0:n.containerRef.current.querySelectorAll(".dnb-forms-iterate__element");e[e.length-1].focus()}}catch(t){}})));!g.current&&k.current&&(k.current=!1,null===(u=r.current)||void 0===u||null===(c=u.fulfillRemove)||void 0===c||c.call(u));null==x||x(e)}),[x,i]),N=(0,o.useCallback)((()=>{k.current=!0,null==c||c({keepItems:!0}),_(!1)}),[c,_]);return(0,f.jsx)(p.Provider,{value:{handleRemoveBlock:N},children:(0,f.jsx)($.Z,{className:u()("dnb-forms-iterate-block",C&&`dnb-forms-iterate-block--variant-${C}`,d&&"dnb-forms-iterate-block--new",r.current.hasErrorAndShowIt&&"dnb-forms-iterate-block--error",b),open:g.current,onAnimationEnd:y,duration:450,keepInDOM:!0,children:(0,f.jsx)(R.Z,{className:"dnb-forms-iterate-block__inner",...j,element:"section","aria-label":m,children:Z})})})}q._supportsSpacingProps=!0;var z=q,D=r(85192),H=r(80215);function T(e){const{children:n,className:r,...t}=e||{};return(0,f.jsxs)(H.Z,{top:"medium",className:u()("dnb-forms-iterate-toolbar",r),...t,children:[(0,f.jsx)(D.Z,{space:0}),(0,f.jsx)(O.Z,{top:"x-small",gap:"large",children:n})]})}function W(e){return(0,f.jsx)(X,{toolbar:(0,f.jsx)(T,{children:(0,f.jsx)(L,{})}),...e})}function X(e){const n=(0,o.useContext)(l.Z),{containerMode:r,isNew:t}=null!=n?n:{},{children:s,className:c,title:i,titleWhenNew:a,toolbar:d,...h}=e||{},v=(0,o.useRef)(t);(0,o.useEffect)((()=>{"view"===r&&(v.current=!1)}),[t,r]);const m=v.current&&a?a:i,p=(0,o.useMemo)((()=>(0,j.F4)(m)),[m]);return(0,f.jsxs)(z,{mode:"edit",className:u()("dnb-forms-iterate-edit-block",c),ariaLabel:p,...h,children:[m&&(0,f.jsx)(B.Z,{size:"basis",children:m}),s,d]})}T._supportsSpacingProps=!0,W._supportsSpacingProps=!0,X._supportsSpacingProps=!0;var G=r(28352);function J(){const e=(0,o.useContext)(l.Z),{switchContainerMode:n}=null!=e?e:{},r=(0,m.Z)().Iterate,t=(0,o.useCallback)((()=>{null==n||n("edit")}),[n]);return(0,f.jsxs)(O.Z,{gap:"large",children:[(0,f.jsx)(c.Z,{variant:"tertiary",icon:G.Z,icon_position:"left",on_click:t,children:r.edit}),(0,f.jsx)(Z,{text:r.remove})]})}function K(e){const{children:n,className:r,title:t,...s}=e||{},c=(0,o.useMemo)((()=>(0,j.F4)(t)),[t]);return(0,f.jsx)(z,{mode:"view",ariaLabel:c,className:u()("dnb-forms-iterate-view-block",r),...s,children:(0,f.jsxs)(R.Z,{children:[t&&(0,f.jsx)(B.Z,{size:"basis",children:t}),n,(0,f.jsx)(T,{children:(0,f.jsx)(J,{})})]})})}K._supportsSpacingProps=!0;var Q=K;function U(e){const n=(0,o.useContext)(l.Z),{isNew:r}=null!=n?n:{};return(0,f.jsx)(X,{open:!r||void 0,...e})}U._supportsSpacingProps=!0;var Y=U,ee=r(49118),ne=r(91749);function re(e){const{data:n}=(0,ee.Z)(e.id);return te(n,e)}function te(e,n){let{path:r,filter:t}=n;if(C().has(e,r)){const n=C().get(e,r);if(Array.isArray(n))return t?n.filter(t).length:n.length;if("object"==typeof n&&n)return t?Object.entries(n).filter(t).length:Object.keys(n).length}return NaN}function oe(e){const{data:n}=(0,ne.Z)(e.id);return te(n,e)}function se(e){void 0===e&&(e=void 0);const{data:n}=(0,ee.Z)(e);return{count:(0,o.useCallback)(((e,r)=>te(n,{path:e,filter:r})),[n])}}const ue=v,ce=Z}}]);
//# sourceMappingURL=fcaa9932712adafddbbdcb9d678d8f14c5eb091e-7199421605b4a6f02609.js.map