"use strict";(self.webpackChunkdnb_design_system_portal=self.webpackChunkdnb_design_system_portal||[]).push([[46573],{51109:function(e,n,r){r.d(n,{Z:function(){return k}});var t=r(84616),o=r(2784),u=r(72779),l=r.n(u),c=r(95955),s=r.n(c),i=r(26409),a=r(37339),d=r(61890),f=r(82507),h=r(26),v=r(30392),m=r(38875),p=r(51022),x=r(58106),Z=r(81011),b=r(21068),w=r(52322);function C(e){let{children:n}=e;const{showAllErrors:r}=(0,o.useContext)(b.Z),t=(0,o.useRef)({}),u=Object.keys(t.current||{}).length>0,l=r&&u,c=(0,o.useCallback)(((e,n)=>{var r;n?t.current[e]=!!n:null===(r=t.current)||void 0===r||delete r[e]}),[]),s={hasError:u,hasErrorAndShowIt:l,errorsRef:t,setFieldError:c};return(0,w.jsx)(Z.Z.Provider,{value:s,children:n})}var g=r(57039),j=r(8160);function R(e){var n;const{0:r,1:u}=(0,o.useReducer)((()=>({})),{}),c=(0,o.useContext)(p.Z),Z=(0,o.useContext)(x.Z),{getValue:b}=(0,j.Z)(),R=(0,o.useMemo)((()=>{const{path:n,countPath:r,countPathLimit:t=1/0,countPathTransform:o}=e;if(r){const u=b(n);let l=parseFloat(b(r));if(l>=0||(l=0),l>t&&(l=t),(null==u?void 0:u.length)!==l){const n=[];for(let e=0,r=l;e<r;e++){const r=null==u?void 0:u[e];n.push(null==o?void 0:o({value:r,index:e}))}return{...e,value:n}}}return e}),[b,e]),{path:k,value:_,withoutFlex:y,emptyValue:N,placeholder:E,handleChange:P,onChange:A,children:S}=(0,i.Z)(R),M=(0,o.useRef)([]),I=(0,o.useRef)({}),B=(0,o.useRef)({}),V=(0,o.useRef)(),F=(0,o.useRef)(_),O=(0,o.useRef)(),L=(0,o.useRef)(),T=(0,o.useRef)({}),$=null!=y?y:c||Z;(0,o.useEffect)((()=>{F.current=_||[]}),[_]);const q=(0,o.useMemo)((()=>{var e;return(null!==(e=V.current||_)&&void 0!==e?e:[]).map(((e,n)=>{var r;const o=M.current[n]||(0,a.Xo)(),l=_.length>(null===(r=F.current)||void 0===r?void 0:r.length);M.current[n]||(I.current[o]=l,M.current.push(o));const c=I.current[o]||!1;return B.current[o]||(B.current[o]=c?"edit":"view"),{id:o,path:k,value:e,index:n,arrayValue:_,containerRef:O,isNew:c,containerMode:B.current[o],switchContainerMode:e=>{var n;B.current[o]=e,null===(n=I.current)||void 0===n||delete n[o],u()},handleChange:(e,r)=>{const t=(0,g.ZP)(_);t[n]={...t[n]},s().set(t,e,r),P(t)},handlePush:e=>{L.current=!0,P([].concat((0,t.Z)(null!=_?_:[]),[e]))},handleRemove:function(e){let{keepItems:r=!1}=void 0===e?{}:e;r&&(V.current=_);const t=(0,g.ZP)(_);t.splice(n,1),P(t)},fulfillRemove:()=>{var e,n;V.current=null,null===(e=B.current)||void 0===e||delete e[o],null===(n=I.current)||void 0===n||delete n[o];const r=M.current.indexOf(o);M.current.splice(r,1),u()},restoreOriginalValue:e=>{const r=(0,g.ZP)(_);r[n]=e,P(r)}}}))}),[r,_,k,P]);(0,o.useMemo)((()=>{const e=null==q?void 0:q[q.length-1];null!=e&&e.isNew&&!L.current?null==A||A(_):L.current=!1}),[_,q,A]);const z={className:l()("dnb-forms-iterate",null==e?void 0:e.className),...(0,v.W)(e),...(0,h.SR)(e),innerRef:O},D=$?o.Fragment:d.Z;return(0,w.jsx)(D,{...$?null:z,children:_===N||0===(null==e||null===(n=e.value)||void 0===n?void 0:n.length)?E:q.map((e=>{const{id:n,value:r,index:t}=e,u=T.current[n]=T.current[n]||(0,o.createRef)(),l=e=>"function"==typeof e?e(r,t):e,c={...e,elementRef:u},s=Array.isArray(S)?S.map((e=>l(e))):l(S);return $?(0,w.jsx)(m.Z.Provider,{value:c,children:(0,w.jsx)(C,{children:s})},`element-${n}`):(0,w.jsx)(f.Z,{className:"dnb-forms-iterate__element",tabIndex:-1,innerRef:u,children:(0,w.jsx)(m.Z.Provider,{value:c,children:(0,w.jsx)(C,{children:s})})},`element-${n}`)}))})}R._supportsSpacingProps=!0;var k=R},49414:function(e,n,r){r.r(n),r.d(n,{AnimatedContainer:function(){return q},Array:function(){return w.Z},ArrayPushButton:function(){return Q},ArrayRemoveElementButton:function(){return U},Count:function(){return X},EditContainer:function(){return B},IterateElementContext:function(){return s.Z},PushButton:function(){return v},RemoveButton:function(){return b},Toolbar:function(){return I},ViewContainer:function(){return T},count:function(){return J},useCount:function(){return K}});var t=r(84616),o=r(2784),u=r(72779),l=r.n(u),c=r(96844),s=r(38875),i=r(26409),a=r(27439),d=r(93206),f=r(52322);function h(e){const n=(0,o.useContext)(s.Z),{handlePush:r}=null!=n?n:{},{pushValue:u,className:h,...v}=e,m=(0,a.wH)(v),{value:p,handleChange:x,children:Z}=(0,i.Z)(v);if(void 0!==p&&!Array.isArray(p))throw new Error("PushButton received a non-array value");const b=(0,o.useCallback)((()=>{const e="function"==typeof u?u(p):u;r?r(e):x([].concat((0,t.Z)(null!=p?p:[]),[e]))}),[p,u,r,x]);return(0,f.jsx)(c.Z,{className:l()("dnb-forms-iterate-push-button",h),variant:"secondary",icon:d.Z,icon_position:"left",on_click:b,...m,children:Z})}h._supportsSpacingProps=!0;var v=h,m=r(21608);var p=(0,o.createContext)(null),x=r(42277);function Z(e){const n=(0,o.useContext)(s.Z),{handleRemove:r}=null!=n?n:{};if(!n)throw new Error("RemoveButton must be inside an Iterate.Array");const{className:t,...u}=e,{children:d,text:h}=(0,i.Z)(u),v=(0,a.wH)(u),Z=(0,m.Z)().Iterate,b=h||d||Z.remove,w=(0,o.useContext)(p),{handleRemoveBlock:C}=null!=w?w:{},g=(0,o.useCallback)((()=>{C?C():r()}),[r,C]);return(0,f.jsx)(c.Z,{className:l()("dnb-forms-iterate-remove-element-button",t),variant:b?"tertiary":"secondary",icon:x.Z,icon_position:"left",on_click:g,...v,children:b})}Z._supportsSpacingProps=!0;var b=Z,w=r(51109),C=r(37339),g=r(58984),j=r(89751),R=r(72691),k=r(88952),_=r(81011);function y(){const{restoreOriginalValue:e,switchContainerMode:n,containerMode:r,arrayValue:t,index:u,isNew:l}=(0,o.useContext)(s.Z)||{},{hasErrorAndShowIt:i}=(0,o.useContext)(_.Z)||{},a=(0,m.Z)().Iterate,d=(0,o.useRef)(),h=function(e){let{isNew:n,containerMode:r}=e;const t=(0,o.useRef)(n);return(0,o.useEffect)((()=>{"view"===r&&(t.current=!1)}),[n,r]),t.current}({isNew:l,containerMode:r});(0,o.useEffect)((()=>{"edit"!==r||d.current||(d.current=null==t?void 0:t[u]),"view"===r&&(d.current=null)}),[t,r,u]);const v=(0,o.useCallback)((()=>{d.current&&(null==e||e(d.current)),null==n||n("view")}),[e,n]),p=(0,o.useCallback)((()=>{null==n||n("view")}),[n]);return(0,f.jsxs)(j.Z,{gap:"large",children:[(0,f.jsx)(c.Z,{variant:"tertiary",icon:R.Z,icon_position:"left",on_click:p,disabled:i,children:a.done}),h?(0,f.jsx)(b,{}):(0,f.jsx)(c.Z,{variant:"tertiary",icon:k.Z,icon_position:"left",on_click:v,children:a.cancel})]})}var N=r(91974),E=r(61890);function P(e){const{1:n}=(0,o.useReducer)((()=>({})),{}),r=(0,o.useRef)();r.current=(0,o.useContext)(s.Z)||{};const{hasError:t,hasErrorAndShowIt:u}=(0,o.useContext)(_.Z)||{};r.current.hasError=t,r.current.hasErrorAndShowIt=u,u&&(r.current.containerMode="edit");const{handleRemove:c,switchContainerMode:i,containerMode:a,isNew:d}=r.current,{mode:h,open:v,ariaLabel:m,onAnimationEnd:x,className:Z,children:b,openDelay:w=100,variant:C="outline",...g}=e,j=(0,o.useRef)(null!=v?v:a===h&&!d),R=(0,o.useRef)(!1),k=(0,o.useCallback)((e=>{j.current=e,n()}),[]);(0,o.useEffect)((()=>{R.current||(void 0!==v?k(v):j.current!==(a===h)&&(d?setTimeout((()=>{k(a===h)}),w):k(a===h)))}),[a,d,h,v,w,k]);const y=(0,o.useCallback)((e=>{r.current.hasErrorAndShowIt&&i("edit");var n,t,o,u,l,c;r.current.hasErrorAndShowIt||("opened"===e?null===(n=r.current)||void 0===n||null===(t=n.elementRef)||void 0===t||null===(o=t.current)||void 0===o||null===(u=o.focus)||void 0===u||u.call(o):window.requestAnimationFrame((()=>{try{var e;if(null===(e=document.activeElement)||void 0===e||!e.closest(".dnb-forms-iterate__element")){var n;const e=null===(n=r.current)||void 0===n?void 0:n.containerRef.current.querySelectorAll(".dnb-forms-iterate__element");e[e.length-1].focus()}}catch(t){}})));!j.current&&R.current&&(R.current=!1,null===(l=r.current)||void 0===l||null===(c=l.fulfillRemove)||void 0===c||c.call(l));null==x||x(e)}),[x,i]),P=(0,o.useCallback)((()=>{R.current=!0,null==c||c({keepItems:!0}),k(!1)}),[c,k]);return(0,f.jsx)(p.Provider,{value:{handleRemoveBlock:P},children:(0,f.jsx)(N.Z,{className:l()("dnb-forms-iterate-block",C&&`dnb-forms-iterate-block--variant-${C}`,d&&"dnb-forms-iterate-block--new",r.current.hasErrorAndShowIt&&"dnb-forms-iterate-block--error",Z),open:j.current,onAnimationEnd:y,duration:450,keepInDOM:!0,children:(0,f.jsx)(E.Z,{className:"dnb-forms-iterate-block__inner",...g,element:"section","aria-label":m,children:b})})})}P._supportsSpacingProps=!0;var A=P,S=r(85192),M=r(80215);function I(e){const{children:n,className:r,...t}=e||{};return(0,f.jsxs)(M.Z,{top:"medium",className:l()("dnb-forms-iterate-toolbar",r),...t,children:[(0,f.jsx)(S.Z,{space:0}),(0,f.jsx)(j.Z,{top:"x-small",gap:"large",children:n})]})}function B(e){return(0,f.jsx)(V,{toolbar:(0,f.jsx)(I,{children:(0,f.jsx)(y,{})}),...e})}function V(e){const n=(0,o.useContext)(s.Z),{containerMode:r,isNew:t}=null!=n?n:{},{children:u,className:c,title:i,titleWhenNew:a,toolbar:d,...h}=e||{},v=(0,o.useRef)(t);(0,o.useEffect)((()=>{"view"===r&&(v.current=!1)}),[t,r]);const m=v.current&&a?a:i,p=(0,o.useMemo)((()=>(0,C.F4)(m)),[m]);return(0,f.jsxs)(A,{mode:"edit",className:l()("dnb-forms-iterate-edit-block",c),ariaLabel:p,...h,children:[m&&(0,f.jsx)(g.Z,{size:"basis",children:m}),u,d]})}I._supportsSpacingProps=!0,B._supportsSpacingProps=!0,V._supportsSpacingProps=!0;var F=r(28352);function O(){const e=(0,o.useContext)(s.Z),{switchContainerMode:n}=null!=e?e:{},r=(0,m.Z)().Iterate,t=(0,o.useCallback)((()=>{null==n||n("edit")}),[n]);return(0,f.jsxs)(j.Z,{gap:"large",children:[(0,f.jsx)(c.Z,{variant:"tertiary",icon:F.Z,icon_position:"left",on_click:t,children:r.edit}),(0,f.jsx)(b,{text:r.remove})]})}function L(e){const{children:n,className:r,title:t,...u}=e||{},c=(0,o.useMemo)((()=>(0,C.F4)(t)),[t]);return(0,f.jsx)(A,{mode:"view",ariaLabel:c,className:l()("dnb-forms-iterate-view-block",r),...u,children:(0,f.jsxs)(E.Z,{children:[t&&(0,f.jsx)(g.Z,{size:"basis",children:t}),n,(0,f.jsx)(I,{children:(0,f.jsx)(O,{})})]})})}L._supportsSpacingProps=!0;var T=L;function $(e){const n=(0,o.useContext)(s.Z),{isNew:r}=null!=n?n:{};return(0,f.jsx)(V,{open:!r||void 0,...e})}$._supportsSpacingProps=!0;var q=$,z=r(95955),D=r.n(z),H=r(49118),W=r(91749);function X(e){const{data:n}=(0,H.Z)(e.id);return G(n,e)}function G(e,n){let{path:r,filter:t}=n;if(D().has(e,r)){const n=D().get(e,r);if(Array.isArray(n))return t?n.filter(t).length:n.length;if("object"==typeof n&&n)return t?Object.entries(n).filter(t).length:Object.keys(n).length}return NaN}function J(e){const{data:n}=(0,W.Z)(e.id);return G(n,e)}function K(e){void 0===e&&(e=void 0);const{data:n}=(0,H.Z)(e);return{count:(0,o.useCallback)(((e,r)=>G(n,{path:e,filter:r})),[n])}}const Q=v,U=b}}]);
//# sourceMappingURL=fcaa9932712adafddbbdcb9d678d8f14c5eb091e-f82b1dc57bf9d8bd1e33.js.map