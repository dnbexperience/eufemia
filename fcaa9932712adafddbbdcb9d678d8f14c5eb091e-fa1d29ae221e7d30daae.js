"use strict";(self.webpackChunkdnb_design_system_portal=self.webpackChunkdnb_design_system_portal||[]).push([[46573],{6350:function(e,n,r){r.r(n),r.d(n,{AnimatedContainer:function(){return Y},Array:function(){return I},ArrayPushButton:function(){return ue},ArrayRemoveElementButton:function(){return le},Count:function(){return re},EditContainer:function(){return $},IterateElementContext:function(){return i.Z},PushButton:function(){return v},RemoveButton:function(){return Z},Toolbar:function(){return W},ViewContainer:function(){return Q},count:function(){return oe},useCount:function(){return ce}});var t=r(84616),o=r(2784),c=r(72779),u=r.n(c),l=r(96844),i=r(38875),s=r(26409),a=r(27439),d=r(93206),f=r(52322);function h(e){const n=(0,o.useContext)(i.Z),{handlePush:r}=null!=n?n:{},{pushValue:c,className:h,...v}=e,m=(0,a.wH)(v),{value:p,handleChange:x,children:b}=(0,s.Z)(v);if(void 0!==p&&!Array.isArray(p))throw new Error("PushButton received a non-array value.");const Z=(0,o.useCallback)((()=>{const e="function"==typeof c?c(p):c;r?r(e):x([].concat((0,t.Z)(null!=p?p:[]),[e]))}),[p,c,r,x]);return(0,f.jsx)(l.Z,{className:u()("dnb-form-iterate-push-button",h),variant:"secondary",icon:d.Z,icon_position:"left",on_click:Z,...m,children:b})}h._supportsSpacingProps=!0;var v=h,m=r(21608);var p=(0,o.createContext)(null),x=r(42277);function b(e){const n=(0,o.useContext)(i.Z),{handleRemove:r}=null!=n?n:{};if(!n)throw new Error("RemoveButton must be inside an Iterate.Array component.");const{className:t,...c}=e,{children:d,text:h}=(0,s.Z)(c),v=(0,a.wH)(c),b=(0,m.Z)().Iterate,Z=h||d||b.remove,w=(0,o.useContext)(p),{handleRemoveBlock:C}=null!=w?w:{},j=(0,o.useCallback)((()=>{C?C():r()}),[r,C]);return(0,f.jsx)(l.Z,{className:u()("dnb-form-iterate-remove-element-button",t),variant:Z?"tertiary":"secondary",icon:x.Z,icon_position:"left",on_click:j,...v,children:Z})}b._supportsSpacingProps=!0;var Z=b,w=r(95955),C=r.n(w),j=r(37339),R=r(61890),g=r(82507),_=r(26),k=r(30392),y=r(51022),N=r(58106),E=r(81011),P=r(21068);function A(e){let{children:n}=e;const{showAllErrors:r}=(0,o.useContext)(P.Z),t=(0,o.useRef)({}),c=Object.keys(t.current||{}).length>0,u=r&&c,l=(0,o.useCallback)(((e,n)=>{var r;n?t.current[e]=!!n:null===(r=t.current)||void 0===r||delete r[e]}),[]),i={hasError:c,hasErrorAndShowIt:u,errorsRef:t,setFieldError:l};return(0,f.jsx)(E.Z.Provider,{value:i,children:n})}var M=r(57039);function S(e){var n;const{0:r,1:c}=(0,o.useReducer)((()=>({})),{}),l=(0,o.useContext)(y.Z),a=(0,o.useContext)(N.Z),{path:d,value:h,withoutFlex:v,emptyValue:m,placeholder:p,handleChange:x,onChange:b,children:Z}=(0,s.Z)(e),w=(0,o.useRef)([]),E=(0,o.useRef)({}),P=(0,o.useRef)({}),S=(0,o.useRef)(),I=(0,o.useRef)(h),B=(0,o.useRef)(),O=(0,o.useRef)(),V=(0,o.useRef)({}),F=null!=v?v:l||a;(0,o.useEffect)((()=>{I.current=h||[]}),[h]);const L=(0,o.useMemo)((()=>{var e;return(null!==(e=S.current||h)&&void 0!==e?e:[]).map(((e,n)=>{var r;const o=w.current[n]||(0,j.Xo)(),u=h.length>(null===(r=I.current)||void 0===r?void 0:r.length);w.current[n]||(E.current[o]=u,w.current.push(o));const l=E.current[o]||!1;return P.current[o]||(P.current[o]=l?"edit":"view"),{id:o,path:d,value:e,index:n,arrayValue:h,containerRef:B,isNew:l,containerMode:P.current[o],switchContainerMode:e=>{P.current[o]=e,c()},handleChange:(e,r)=>{const t=(0,M.ZP)(h);t[n]={...t[n]},C().set(t,e,r),x(t)},handlePush:e=>{O.current=!0,x([].concat((0,t.Z)(null!=h?h:[]),[e]))},handleRemove:function(e){let{keepItems:r=!1}=void 0===e?{}:e;r&&(S.current=h);const t=(0,M.ZP)(h);t.splice(n,1),x(t)},fulfillRemove:()=>{var e,n;S.current=null,null===(e=P.current)||void 0===e||delete e[o],null===(n=E.current)||void 0===n||delete n[o];const r=w.current.indexOf(o);w.current.splice(r,1),c()},restoreOriginalValue:e=>{const r=(0,M.ZP)(h);r[n]=e,x(r)}}}))}),[r,h,d,x]);(0,o.useMemo)((()=>{const e=null==L?void 0:L[L.length-1];null!=e&&e.isNew&&!O.current?null==b||b(h):O.current=!1}),[h,L,b]);const q={className:u()("dnb-form-iterate",null==e?void 0:e.className),...(0,k.W)(e),...(0,_.SR)(e),innerRef:B},z=F?o.Fragment:R.Z;return(0,f.jsx)(z,{...F?null:q,children:h===m||0===(null==e||null===(n=e.value)||void 0===n?void 0:n.length)?p:L.map((e=>{const{id:n,value:r,index:t}=e,c=V.current[n]=V.current[n]||(0,o.createRef)(),u=e=>"function"==typeof e?e(r,t):e,l={...e,elementRef:c},s=Array.isArray(Z)?Z.map((e=>u(e))):u(Z);return F?(0,f.jsx)(i.Z.Provider,{value:l,children:(0,f.jsx)(A,{children:s})},`element-${n}`):(0,f.jsx)(g.Z,{className:"dnb-form-iterate__element",tabIndex:-1,innerRef:c,children:(0,f.jsx)(i.Z.Provider,{value:l,children:(0,f.jsx)(A,{children:s})})},`element-${n}`)}))})}S._supportsSpacingProps=!0;var I=S,B=r(58984),O=r(89751),V=r(72691),F=r(88952);function L(){const e=(0,o.useContext)(i.Z),{restoreOriginalValue:n,switchContainerMode:r,containerMode:t,arrayValue:c,index:u,isNew:s}=null!=e?e:{},a=(0,m.Z)().Iterate,d=(0,o.useRef)(),h=function(e){let{isNew:n,containerMode:r}=e;const t=(0,o.useRef)(n);return(0,o.useEffect)((()=>{"view"===r&&(t.current=!1)}),[n,r]),t.current}({isNew:s,containerMode:t});(0,o.useEffect)((()=>{"edit"!==t||d.current||(d.current=null==c?void 0:c[u]),"view"===t&&(d.current=null)}),[c,t,u]);const v=(0,o.useCallback)((()=>{d.current&&(null==n||n(d.current)),null==r||r("view")}),[n,r]),p=(0,o.useCallback)((()=>{null==r||r("view")}),[r]);return(0,f.jsxs)(O.Z,{spacing:"large",children:[(0,f.jsx)(l.Z,{variant:"tertiary",icon:V.Z,icon_position:"left",on_click:p,children:a.done}),h?(0,f.jsx)(Z,{}):(0,f.jsx)(l.Z,{variant:"tertiary",icon:F.Z,icon_position:"left",on_click:v,children:a.cancel})]})}var q=r(91974);function z(e){const{1:n}=(0,o.useReducer)((()=>({})),{}),r=(0,o.useRef)();r.current=(0,o.useContext)(i.Z)||{};const{hasError:t,hasErrorAndShowIt:c}=(0,o.useContext)(E.Z)||{};r.current.hasError=t,r.current.hasErrorAndShowIt=c,c&&(r.current.containerMode="edit");const{handleRemove:l,switchContainerMode:s,containerMode:a,isNew:d}=r.current,{mode:h,open:v,ariaLabel:m,onAnimationEnd:x,className:b,children:Z,openDelay:w=100,...C}=e,j=(0,o.useRef)(null!=v?v:a===h&&!d),g=(0,o.useRef)(!1),_=(0,o.useCallback)((e=>{j.current=e,n()}),[]);(0,o.useEffect)((()=>{g.current||(void 0!==v?_(v):j.current!==(a===h)&&(d?setTimeout((()=>{_(a===h)}),w):_(a===h)))}),[a,d,h,v,w,_]);const k=(0,o.useCallback)((e=>{r.current.hasErrorAndShowIt&&s("edit");var n,t,o,c,u,l;r.current.hasError||("opened"===e?null===(n=r.current)||void 0===n||null===(t=n.elementRef)||void 0===t||null===(o=t.current)||void 0===o||null===(c=o.focus)||void 0===c||c.call(o):window.requestAnimationFrame((()=>{try{var e;if(null===(e=document.activeElement)||void 0===e||!e.closest(".dnb-form-iterate__element")){var n;const e=null===(n=r.current)||void 0===n?void 0:n.containerRef.current.querySelectorAll(".dnb-form-iterate__element");e[e.length-1].focus()}}catch(t){}})));!j.current&&g.current&&(g.current=!1,null===(u=r.current)||void 0===u||null===(l=u.fulfillRemove)||void 0===l||l.call(u));null==x||x(e)}),[x,s]),y=(0,o.useCallback)((()=>{g.current=!0,null==l||l({keepItems:!0}),_(!1)}),[l,_]);return(0,f.jsx)(p.Provider,{value:{handleRemoveBlock:y},children:(0,f.jsx)(q.Z,{className:u()("dnb-form-iterate-block",d&&"dnb-form-iterate-block--new",r.current.hasError&&"dnb-form-iterate-block--error",b),open:j.current,onAnimationEnd:k,duration:450,keepInDOM:!0,children:(0,f.jsx)(R.Z,{className:"dnb-form-iterate-block__inner",...C,element:"section","aria-label":m,children:Z})})})}z._supportsSpacingProps=!0;var D=z,H=r(85192),T=r(80215);function W(e){const{children:n,className:r,...t}=e||{};return(0,f.jsxs)(T.Z,{top:"medium",className:u()("dnb-form-iterate-toolbar",r),...t,children:[(0,f.jsx)(H.Z,{space:0}),(0,f.jsx)(O.Z,{top:"x-small",spacing:"large",children:n})]})}function $(e){return(0,f.jsx)(X,{toolbar:(0,f.jsx)(W,{children:(0,f.jsx)(L,{})}),...e})}function X(e){const n=(0,o.useContext)(i.Z),{containerMode:r,isNew:t}=null!=n?n:{},{children:c,className:l,title:s,titleWhenNew:a,toolbar:d,...h}=e||{},v=(0,o.useRef)(t);(0,o.useEffect)((()=>{"view"===r&&(v.current=!1)}),[t,r]);const m=v.current&&a?a:s,p=(0,o.useMemo)((()=>(0,j.F4)(m)),[m]);return(0,f.jsxs)(D,{mode:"edit",className:u()("dnb-form-iterate-edit-block",l),ariaLabel:p,...h,children:[m&&(0,f.jsx)(B.Z,{size:"basis",children:m}),c,d]})}W._supportsSpacingProps=!0,$._supportsSpacingProps=!0,X._supportsSpacingProps=!0;var G=r(28352);function J(){const e=(0,o.useContext)(i.Z),{switchContainerMode:n}=null!=e?e:{},r=(0,m.Z)().Iterate,t=(0,o.useCallback)((()=>{null==n||n("edit")}),[n]);return(0,f.jsxs)(O.Z,{spacing:"large",children:[(0,f.jsx)(l.Z,{variant:"tertiary",icon:G.Z,icon_position:"left",on_click:t,children:r.edit}),(0,f.jsx)(Z,{text:r.remove})]})}function K(e){const{children:n,className:r,title:t,...c}=e||{},l=(0,o.useMemo)((()=>(0,j.F4)(t)),[t]);return(0,f.jsx)(D,{mode:"view",ariaLabel:l,className:u()("dnb-form-iterate-view-block",r),...c,children:(0,f.jsxs)(R.Z,{children:[t&&(0,f.jsx)(B.Z,{size:"basis",children:t}),n,(0,f.jsx)(W,{children:(0,f.jsx)(J,{})})]})})}K._supportsSpacingProps=!0;var Q=K;function U(e){const n=(0,o.useContext)(i.Z),{isNew:r}=null!=n?n:{};return(0,f.jsx)(X,{open:!r||void 0,...e})}U._supportsSpacingProps=!0;var Y=U,ee=r(49118),ne=r(91749);function re(e){const{data:n}=(0,ee.Z)(e.id);return te(n,e)}function te(e,n){let{path:r,filter:t}=n;if(C().has(e,r)){const n=C().get(e,r);if(Array.isArray(n))return t?n.filter(t).length:n.length;if("object"==typeof n&&n)return t?Object.entries(n).filter(t).length:Object.keys(n).length}return NaN}function oe(e){const{data:n}=(0,ne.Z)(e.id);return te(n,e)}function ce(e){void 0===e&&(e=void 0);const{data:n}=(0,ee.Z)(e);return{count:(0,o.useCallback)(((e,r)=>te(n,{path:e,filter:r})),[n])}}const ue=v,le=Z}}]);
//# sourceMappingURL=fcaa9932712adafddbbdcb9d678d8f14c5eb091e-fa1d29ae221e7d30daae.js.map