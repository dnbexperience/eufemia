---
title: 'FAQ'
order: 7
icon: 'helper_classes'
---

# Frequently Asked Questions (FAQ)

## Visual tests and Playwright

Jest starts several workers at the same time. When we simulate states on e.g., ToggleButton and Button, Playwright (v1.31.2) struggles to handle this. Some of the hover or focus tests will fail. To ensure Jest never executes several workers at the same time, we set `--maxWorkers=1`.

### Installing screenshot browser

For running screenshot tests (visual tests), a headless Firefox browser is needed.

In normal circumstances, the browser will be installed automatically via `yarn install` â€“ but to either upgrade to a newer version, or to wipe out existing versions and run the install manually, you can run these commands, depending on your needs:

```
yarn workspace @dnb/eufemia playwright uninstall --all
yarn workspace @dnb/eufemia add -D @playwright/test
yarn workspace @dnb/eufemia playwright install firefox

yarn workspace dnb-design-system-portal playwright uninstall --all
yarn workspace dnb-design-system-portal add -D @playwright/test
yarn workspace dnb-design-system-portal playwright install firefox
```

#### Alternative install: skip authentication

However, since Node.js and corporate proxies do not enjoy each other's company, this might
fail with an `Error: unable to get local issuer certificate` error. In that case, your only
option might be to disable all authentication for this command.

```
NODE_TLS_REJECT_UNAUTHORIZED=0 yarn workspace @dnb/eufemia playwright install firefox
```

#### Alternative install: manually

Or, in the very worst case, you can manually download the zip file that `yarn workspace 
@dnb/eufemia playwright install firefox` attempts to download, and extract the file
("Nightly" for Firefox) to the folder indicated when `yarn test:screenshots` fails.

## How can I run all screenshot tests without stopping on first failure?

By default, screenshot tests stop on the first failure (`--bail` flag). To run all tests and see all failures at once, include `--run-all` in your commit message:

```bash
git commit -m "feat: implement new feature --run-all"
```

This will disable the `--bail` flag and run all screenshot tests, showing you all visual differences at once. This is particularly useful when you're making changes that might affect multiple components and want to see the full scope of visual changes.

The CI/CD pipeline automatically detects this flag and adjusts the test behavior accordingly.

## How can I make faster builds?

This is only meant for "setup-testing" purposes! To make faster local builds, you can:

- Inside `gatsby-config.js`, rename all sourcing from `/docs` to `/docs_dummy`.

Run `yarn workspace dnb-design-system-portal build:visual-test`.

You can also run `filter=button,input yarn start` (case sensitive) to only run specific pages.

### What are `build:mini` scripts

When running `build:mini` scripts, the build will be faster and the output will be smaller. Its used for the CI/CD pipeline to build the package for the Sandbox or documentation preview.

For the Portal, `build:mini` (`BUILD_MINI=1`) also skips some Gatsby plugins and processing steps to speed up the build. This currently includes:

- `gatsby-plugin-eufemia-llm-metadata`
- `gatsby-plugin-manifest`
- `gatsby-plugin-meta-redirect`
- `gatsby-plugin-offline`
- `gatsby-plugin-algolia`
- Image processing (`gatsby-plugin-sharp`, `gatsby-remark-images`)

## Dependency issues

### ESLint compat patch

- We patch `eslint-plugin-compat` to always report APIs, even inside `if` statements. The patch lives in `.yarn/patches/` and is referenced from `packages/dnb-eufemia/package.json` as `patch:eslint-plugin-compat@npm:*`. If you reinstall dependencies, keep the patch or reapply it with `yarn patch-commit`.

### Jest

- jsdom [v21](https://github.com/jsdom/jsdom/releases/tag/21.0.0) changed `window`, `document`, `location`, and top properties of Window to be non-configurable, which made it impossible to mock `window.location` in Jest. While there are workarounds, we decided to use v20 instead of the latest (`"jest-environment-jsdom/jsdom": "20.0.3"`).

### Babel

- Due to this bug: https://github.com/babel/babel/issues/11394 we add `.png,.snap` so they do not get copied: `--extensions '.js,.ts,.tsx,.png,.snap'`

### Yarn PnP

Eufemia uses yarn with `node_modules`.

When switching over to Yarn PnP, there are some issues:

- Storybook:
  ```bash
  ERROR in eufemia/.yarn/__virtual__/@dnb-eufemia-virtual-761b82657c/1/packages/dnb-eufemia/src/components/slider/style/dnb-range.scss (eufemia/.yarn/__virtual__/css-loader-virtual-37c5c374e4/0/cache/css-loader-npm-5.2.7-e1e8b8d16f-fb0742b30a.zip/node_modules/css-loader/dist/cjs.js!eufemia/.yarn/__virtual__/sass-loader-virtual-577853f541/0/cache/sass-loader-npm-10.2.0-91ed64638b-d53212e5d1.zip/node_modules/sass-loader/dist/cjs.js!eufemia/.yarn/__virtual__/@dnb-eufemia-virtual-761b82657c/1/packages/dnb-eufemia/src/components/slider/style/dnb-range.scss)
  Module build failed (from eufemia/.yarn/__virtual__/sass-loader-virtual-577853f541/0/cache/sass-loader-npm-10.2.0-91ed64638b-d53212e5d1.zip/node_modules/sass-loader/dist/cjs.js):
  SassError: File to import not found or unreadable: eufemia/.yarn/__virtual__/@dnb-eufemia-virtual-761b82657c/1/packages/dnb-eufemia/src/style/components/imports.scss.
          on line 6 of ../../.yarn/__virtual__/@dnb-eufemia-virtual-761b82657c/1/packages/dnb-eufemia/src/components/slider/style/dnb-range.scss
  >> @import '../../../style/components/imports.scss';
  ```
- Gatsby
  ```bash
  gatsby-plugin-mdx tried to access mkdirp, but it isn't declared in its dependencies; this makes the require call ambiguous and unsound.
  ```

## MDX v1 > v2/v3

In MDX v1 the Portal used an MDX template (`./templates/mdx.js`) with the `createPage` API. This is currently not the case anymore.
Instead, the "PortalLayout" is used to wrap `.mdx` pages inside the `wrapPageElement` API.
This is due to the `JavaScript heap out of memory` error when using templates.

## I get a Gatsby 404 Not Found error on the pages I work on

- Try cleaning the cache: `yarn workspace dnb-design-system-portal gatsby clean`
- Try running `yarn build` again
